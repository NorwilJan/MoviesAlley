<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MovieHouse</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=DM+Serif+Display&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { background: #15191e; color: #eee; font-family: "DM Serif Display", serif; }
    a { color: inherit; text-decoration: none; }
    a:hover { color: #1976d2; text-decoration: none; }
    .tm-text-primary { color: #1976d2; }
    .tm-bg-primary { background: #1976d2; }
    .tm-bg-gray { background: #1a1f25; }
    .tm-text-gray { color: #999; }
    .tm-container-small { max-width: 1050px; }
    .navbar { transition: all 0.5s; }
    .navbar.scrolled { background: #15191e; }
    .navbar-brand img { height: 50px; }
    .navbar-brand { font-family: "Montserrat", sans-serif; font-size: 1.75rem; font-weight: 900; }
    .nav-item:hover .nav-link { color: #1976d2; }
    .nav-link { font-size: 1.1rem; padding: 0.5rem 1rem; }
    .tm-hero { min-height: 100px; background-size: cover; background-position: center; }
    .tm-search-form { max-width: 600px; margin: 2em auto; }
    .tm-search-input { background: #1a1f25; color: #eee; border: none; border-radius: 25px 0 0 25px; padding: 0.75rem 1.5rem; }
    .tm-search-input:focus { background: #1a1f25; color: #eee; }
    .tm-search-btn { background: #1976d2; color: #fff; border: none; border-radius: 0 25px 25px 0; padding: 0.75rem 1.5rem; }
    .tm-search-btn:hover { background: #1565c0; }
    .tm-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; padding: 1rem; }
    .tm-grid-item { position: relative; cursor: pointer; }
    .tm-grid-item img { width: 100%; height: auto; border-radius: 8px; }
    .tm-grid-item:hover img { opacity: 0.8; }
    .tm-grid-item-title { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.7); color: #fff; padding: 0.5rem; text-align: center; font-size: 0.9rem; }
    .tm-section-title { font-family: "Montserrat", sans-serif; font-size: 2rem; margin-bottom: 1rem; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(21, 25, 30, 0.94); z-index: 99; overflow-y: auto; }
    .modal-content { margin: 2rem auto; background: #1a1f25; max-width: 95%; width: 1200px; border-radius: 8px; position: relative; }
    .modal-body { display: flex; gap: 2rem; padding: 2rem; }
    .modal-body img { max-width: 300px; border-radius: 8px; }
    .modal-text { flex: 1; }
    .modal-text h2 { font-family: "Montserrat", sans-serif; font-size: 2rem; margin-bottom: 0.5rem; }
    .modal-genre span { background: #1976d2; color: #fff; padding: 0.2rem 0.5rem; margin-right: 0.5rem; border-radius: 4px; font-size: 0.9rem; }
    .modal-cast, .modal-crew { margin: 1rem 0; }
    .modal-cast span, .modal-crew span { display: inline-block; margin-right: 0.5rem; }
    .modal-trailer { margin: 1rem 0; }
    .close { position: absolute; top: 1rem; right: 1rem; font-size: 2rem; cursor: pointer; color: #eee; }
    .close:hover { color: #1976d2; }
    .stars { color: #f5c518; margin: 0.5rem 0; }
    .iframe-container { position: relative; margin: 0 2rem 2rem; }
    .iframe-container iframe { width: 100%; height: 500px; border: none; border-radius: 8px; }
    .iframe-play-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; border-radius: 8px; }
    .iframe-play-overlay i { font-size: 3rem; color: #fff; }
    .server-selector { text-align: center; margin-bottom: 1rem; }
    .server-selector select { background: #1a1f25; color: #eee; border: 1px solid #1976d2; padding: 0.5rem; border-radius: 4px; }
    .tm-footer { border-top: 1px solid #333; }
    .tm-footer-title { font-family: "Montserrat", sans-serif; }
    .tm-footer-links { list-style: none; padding: 0; }
    .tm-footer-links li { margin-bottom: 0.5rem; }
    .tm-footer-links a:hover { color: #1976d2; }
    .share-btn { background: #1976d2; color: #fff; border: none; padding: 0.5rem 1rem; border-radius: 4px; margin-top: 1rem; }
    .share-btn:hover { background: #1565c0; }
    .favorite-btn { background: none; border: none; color: #eee; font-size: 1.5rem; margin-left: 1rem; cursor: pointer; }
    .favorite-btn:hover, .favorite-btn.favorited { color: #e91e63; }
    .tv-episode-next-btn { background: #1976d2; color: #fff; border: none; padding: 0.5rem 1rem; border-radius: 4px; }
    .tv-episode-next-btn:hover { background: #1565c0; }
    .tv-season-episode-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; padding: 1rem; }
    .tv-season-episode-grid .episode-card { background: #15191e; padding: 0.5rem; border-radius: 8px; text-align: center; cursor: pointer; }
    .tv-season-episode-grid .episode-card:hover { background: #1a1f25; }
    .tv-season-episode-grid .episode-card img { width: 100%; height: auto; border-radius: 4px; }
    .error-message { color: #e91e63; text-align: center; margin: 1rem 0; }
    @media (max-width: 768px) {
      .modal-body { flex-direction: column; }
      .modal-body img { max-width: 100%; }
      .iframe-container iframe { height: 300px; }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid tm-container-small">
      <a class="navbar-brand" href="#">
        <img src="https://via.placeholder.com/50" alt="Logo">
        MovieDck
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#movie-nav" aria-controls="movie-nav" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars tm-text-gray"></i>
      </button>
      <div class="collapse navbar-collapse" id="movie-nav">
        <ul class="navbar-nav ml-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#" data-section="home">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-section="movies">Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-section="tv">TV Shows</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-section="anime">Anime</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-section="favorites">Favorites</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="tm-hero d-flex justify-content-center align-items-center" data-parallax="scroll" data-image-src="">
    <form class="d-flex tm-search-form" id="movie-search-form" autocomplete="off">
      <input class="form-control tm-search-input" id="movie-search" type="search" placeholder="Search movies or TV shows..." aria-label="Search">
      <button class="tm-search-btn" type="submit">
        <i class="fas fa-search"></i>
      </button>
    </form>
  </div>
  <div class="container-fluid tm-container-small">
    <section id="home" class="tm-section">
      <h2 class="tm-section-title tm-text-primary">Popular Movies</h2>
      <div class="tm-grid" id="popular-movies"></div>
      <h2 class="tm-section-title tm-text-primary">Popular TV Shows</h2>
      <div class="tm-grid" id="popular-tv"></div>
      <h2 class="tm-section-title tm-text-primary">Popular Anime</h2>
      <div class="tm-grid" id="popular-anime"></div>
    </section>
    <section id="movies" class="tm-section" style="display: none;">
      <h2 class="tm-section-title tm-text-primary">Movies</h2>
      <div class="tm-grid" id="movie-grid"></div>
    </section>
    <section id="tv" class="tm-section" style="display: none;">
      <h2 class="tm-section-title tm-text-primary">TV Shows</h2>
      <div class="tm-grid" id="tv-grid"></div>
    </section>
    <section id="anime" class="tm-section" style="display: none;">
      <h2 class="tm-section-title tm-text-primary">Anime</h2>
      <div class="tm-grid" id="anime-grid"></div>
    </section>
    <section id="favorites" class="tm-section" style="display: none;">
      <h2 class="tm-section-title tm-text-primary">Favorites</h2>
      <div class="tm-grid" id="favorites-grid"></div>
    </section>
    <section id="search-results" class="tm-section" style="display: none;">
      <h2 class="tm-section-title tm-text-primary">Search Results</h2>
      <div class="tm-grid" id="search-grid"></div>
    </section>
  </div>
  <div id="modal" class="modal">
    <div class="modal-content" id="modal-content-movie">
      <span class="close" onclick="closeModal()">Ã—</span>
      <div class="modal-body">
        <img id="modal-image" src="" alt="Poster">
        <div class="modal-text">
          <h2 id="modal-title"></h2>
          <div class="stars" id="modal-rating"></div>
          <div class="modal-genre" id="modal-genres"></div>
          <p id="modal-description"></p>
          <div class="modal-cast" id="modal-cast"></div>
          <div class="modal-crew" id="modal-crew"></div>
          <div class="modal-trailer" id="modal-trailer"></div>
          <button class="share-btn" id="share-movie-btn" onclick="shareMovie()">Share</button>
        </div>
      </div>
      <div class="donation-banner" style="text-align: center; margin: 10px auto; background: #1a1f25; padding: 10px; border-radius: 4px; position: relative;">
        <p style="margin: 0; color: #eee;">Enjoying MovieDck? Support us to keep it free!</p>
        <a href="https://www.buymeacoffee.com/MovieDckWFPH" target="_blank" class="btn btn-primary" style="background: #1976d2; border: none; padding: 8px 16px; margin-top: 5px;">
          Buy Us a Coffee
        </a>
      </div>
      <div class="server-selector">
        <label for="server">Change Server:</label>
        <select id="server" onchange="changeServer()">
          <option value="player.videasy.net" selected>Player.Videasy.net</option>
          <option value="vidsrc.cc">Vidsrc.cc</option>
          <option value="vidsrc.me">Vidsrc.me</option>
        </select>
      </div>
      <div class="iframe-container">
        <iframe id="modal-video" allowfullscreen autoplay></iframe>
        <button class="iframe-play-overlay" onclick="triggerIframePlay('modal-video')">
          <i class="fas fa-play"></i>
        </button>
      </div>
      <div id="similar-movies" style="padding: 1rem 2rem;"></div>
    </div>
    <div class="modal-content" id="modal-content-tv" style="display: none;">
      <span class="close" onclick="closeModal()">Ã—</span>
      <div class="modal-body">
        <img id="tv-modal-image" src="" alt="Poster">
        <div class="modal-text">
          <h2 id="tv-modal-title"></h2>
          <div class="modal-genre" id="tv-modal-genres"></div>
          <p id="tv-modal-description"></p>
          <div><strong>First Air Date:</strong> <span id="tv-modal-air-date"></span></div>
          <div><strong>Seasons:</strong> <span id="tv-modal-total-seasons"></span></div>
          <button class="share-btn" id="share-tv-btn" onclick="shareTvShow()" style="margin-bottom: 1em;">Share</button>
          <button class="favorite-btn" id="tv-favorite-btn" title="Add to favorites" aria-label="Add to favorites" tabindex="0">
            <i class="fas fa-heart"></i>
          </button>
          <div id="tv-modal-seasons-list"></div>
        </div>
      </div>
      <div class="donation-banner" style="text-align: center; margin: 10px auto; background: #1a1f25; padding: 10px; border-radius: 4px; position: relative;">
        <p style="margin: 0; color: #eee;">Enjoying MovieDck? Support us to keep it free!</p>
        <a href="https://www.buymeacoffee.com/MovieDckWFPH" target="_blank" class="btn btn-primary" style="background: #1976d2; border: none; padding: 8px 16px; margin-top: 5px;">
          Buy Us a Coffee
        </a>
      </div>
      <div class="iframe-container">
        <iframe id="tv-episode-player" allowfullscreen autoplay style="display: none;"></iframe>
        <button class="iframe-play-overlay" onclick="triggerIframePlay('tv-episode-player')">
          <i class="fas fa-play"></i>
        </button>
      </div>
      <div style="display: flex; justify-content: center;">
        <button class="tv-episode-next-btn" id="tv-episode-next-btn" style="display: none; margin-bottom: 1em;">Next Episode Â»</button>
      </div>
    </div>
  </div>
  <footer class="tm-bg-gray pt-5 pb-3 tm-text-gray tm-footer">
    <div class="container-fluid tm-container-small">
      <div class="row">
        <div class="col-lg-6 col-md-12 col-12 px-5 mb-5">
          <h3 class="tm-text-primary mb-4 tm-footer-title">About MovieDck</h3>
          <p>MovieDck is a free, open movie & TV show browser using TMDB, supporting favorites and more. Built for education and fun.</p>
          <a href="https://www.buymeacoffee.com/MovieDckWFPH" target="_blank" class="btn btn-primary" style="background: #1976d2; border: none; padding: 10px 20px; margin-top: 10px;">
            Support Us on Buy Me a Coffee!
          </a>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6 col-12 px-5 mb-5">
          <h3 class="tm-text-primary mb-4 tm-footer-title">Quick Links</h3>
          <ul class="tm-footer-links pl-0">
            <li><a href="mailto:norwilaxie@gmail.com">Contact</a></li>
            <li><a href="https://www.buymeacoffee.com/MovieDckWFPH" target="_blank">Donate</a></li>
          </ul>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6 col-12 px-5 mb-5">
        </div>
      </div>
      <div class="row">
        <div class="col-lg-8 col-md-7 col-12 px-5 mb-3">Copyright 2025 MovieDck Project.</div>
      </div>
    </div>
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/parallax/3.1.0/parallax.min.js"></script>
  <script>
    const apiKey = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI1OTQ4NDVhN2ZiZmZiYzVhODExYzVhNzkyZTU2NDVhMyIsInN1YiI6IjY2NTk2ODRhNzVhZGU2ZDY4MWE2YjMwNCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.wu0y8jG6bW0bOaW2Y8yM2G6bW0bOaW2Y8yM2G6bW0bOaW2";
    const baseImageUrl = "https://image.tmdb.org/t/p/w500";
    let currentPage = { movies: 1, tv: 1, anime: 1 };
    let currentSection = "home";
    let lastModalMovie = null;
    let lastModalTvShow = null;
    let currentSeason = 1;
    let currentEpisode = 1;

    function setNavbarScrolled() {
      const navbar = document.querySelector(".navbar");
      if (window.scrollY > 50) {
        navbar.classList.add("scrolled");
      } else {
        navbar.classList.remove("scrolled");
      }
    }

    async function fetchTMDB(endpoint, params = {}) {
      const url = new URL(`https://api.themoviedb.org/3${endpoint}`);
      url.searchParams.append("api_key", apiKey);
      Object.keys(params).forEach((key) => url.searchParams.append(key, params[key]));
      const response = await fetch(url);
      return response.json();
    }

    function createGridItem(item, type) {
      const div = document.createElement("div");
      div.className = "tm-grid-item";
      div.innerHTML = `
        <img src="${baseImageUrl}${item.poster_path || item.backdrop_path}" alt="${item.title || item.name}">
        <div class="tm-grid-item-title">${item.title || item.name}</div>
      `;
      div.onclick = () => type === "tv" ? openTvModal(item) : openMovieModal(item);
      return div;
    }

    async function loadMovies(page = 1) {
      const data = await fetchTMDB("/movie/popular", { page });
      const grid = document.getElementById("movie-grid");
      grid.innerHTML = "";
      data.results.forEach((movie) => grid.appendChild(createGridItem(movie, "movie")));
      currentPage.movies = page;
    }

    async function loadTVShows(page = 1) {
      const data = await fetchTMDB("/tv/popular", { page });
      const grid = document.getElementById("tv-grid");
      grid.innerHTML = "";
      data.results.forEach((show) => grid.appendChild(createGridItem(show, "tv")));
      currentPage.tv = page;
    }

    async function loadAnime(page = 1) {
      const data = await fetchTMDB("/discover/tv", { with_genres: 16, page });
      const grid = document.getElementById("anime-grid");
      grid.innerHTML = "";
      data.results.forEach((anime) => grid.appendChild(createGridItem(anime, "tv")));
      currentPage.anime = page;
    }

    async function loadHomeContent() {
      const [movies, tv, anime] = await Promise.all([
        fetchTMDB("/movie/popular"),
        fetchTMDB("/tv/popular"),
        fetchTMDB("/discover/tv", { with_genres: 16 }),
      ]);
      document.getElementById("popular-movies").innerHTML = "";
      document.getElementById("popular-tv").innerHTML = "";
      document.getElementById("popular-anime").innerHTML = "";
      movies.results.slice(0, 8).forEach((movie) => document.getElementById("popular-movies").appendChild(createGridItem(movie, "movie")));
      tv.results.slice(0, 8).forEach((show) => document.getElementById("popular-tv").appendChild(createGridItem(show, "tv")));
      anime.results.slice(0, 8).forEach((anime) => document.getElementById("popular-anime").appendChild(createGridItem(anime, "tv")));
    }

    async function searchContent(query) {
      const [movies, tv] = await Promise.all([
        fetchTMDB("/search/movie", { query }),
        fetchTMDB("/search/tv", { query }),
      ]);
      const grid = document.getElementById("search-grid");
      grid.innerHTML = "";
      movies.results.concat(tv.results).forEach((item) => {
        const type = item.title ? "movie" : "tv";
        grid.appendChild(createGridItem(item, type));
      });
      document.querySelectorAll(".tm-section").forEach((section) => (section.style.display = "none"));
      document.getElementById("search-results").style.display = "block";
      currentSection = "search-results";
    }

    function loadFavorites() {
      const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      const grid = document.getElementById("favorites-grid");
      grid.innerHTML = "";
      favorites.forEach((item) => grid.appendChild(createGridItem(item, item.type)));
    }

    async function openMovieModal(movie) {
      lastModalMovie = movie;
      const modal = document.getElementById("modal");
      const modalContentMovie = document.getElementById("modal-content-movie");
      const modalContentTv = document.getElementById("modal-content-tv");
      modalContentMovie.style.display = "block";
      modalContentTv.style.display = "none";
      modal.style.display = "block";
      document.getElementById("modal-image").src = `${baseImageUrl}${movie.poster_path}`;
      document.getElementById("modal-title").textContent = movie.title;
      document.getElementById("modal-description").textContent = movie.overview;
      const rating = Math.round(movie.vote_average / 2);
      document.getElementById("modal-rating").innerHTML = "â˜…".repeat(rating) + "â˜†".repeat(5 - rating);
      const [details, credits, videos, similar] = await Promise.all([
        fetchTMDB(`/movie/${movie.id}`),
        fetchTMDB(`/movie/${movie.id}/credits`),
        fetchTMDB(`/movie/${movie.id}/videos`),
        fetchTMDB(`/movie/${movie.id}/similar`),
      ]);
      document.getElementById("modal-genres").innerHTML = details.genres.map((g) => `<span>${g.name}</span>`).join("");
      document.getElementById("modal-cast").innerHTML = `<strong>Cast:</strong> ${credits.cast.slice(0, 5).map((c) => `<span>${c.name}</span>`).join(", ")}`;
      document.getElementById("modal-crew").innerHTML = `<strong>Director:</strong> ${credits.crew.find((c) => c.job === "Director")?.name || "N/A"}`;
      const trailer = videos.results.find((v) => v.type === "Trailer" && v.site === "YouTube");
      document.getElementById("modal-trailer").innerHTML = trailer
        ? `<a href="https://www.youtube.com/watch?v=${trailer.key}" target="_blank">Watch Trailer</a>`
        : "";
      const similarMovies = document.getElementById("similar-movies");
      similarMovies.innerHTML = "<h3>Similar Movies</h3>";
      similar.results.slice(0, 8).forEach((movie) => similarMovies.appendChild(createGridItem(movie, "movie")));
      changeServer();
      const favoriteBtn = document.getElementById("share-movie-btn").nextElementSibling;
      favoriteBtn.className = `favorite-btn ${isFavorite(movie.id, "movie") ? "favorited" : ""}`;
      favoriteBtn.onclick = () => toggleFavorite(movie, "movie");
    }

    async function openTvModal(show) {
      lastModalTvShow = show;
      const modal = document.getElementById("modal");
      const modalContentMovie = document.getElementById("modal-content-movie");
      const modalContentTv = document.getElementById("modal-content-tv");
      modalContentMovie.style.display = "none";
      modalContentTv.style.display = "block";
      modal.style.display = "block";
      document.getElementById("tv-modal-image").src = `${baseImageUrl}${show.poster_path}`;
      document.getElementById("tv-modal-title").textContent = show.name;
      document.getElementById("tv-modal-description").textContent = show.overview;
      document.getElementById("tv-modal-air-date").textContent = show.first_air_date;
      document.getElementById("tv-modal-total-seasons").textContent = show.number_of_seasons;
      const details = await fetchTMDB(`/tv/${show.id}`);
      document.getElementById("tv-modal-genres").innerHTML = details.genres.map((g) => `<span>${g.name}</span>`).join("");
      const seasonsList = document.getElementById("tv-modal-seasons-list");
      seasonsList.innerHTML = "";
      for (let i = 1; i <= show.number_of_seasons; i++) {
        const season = await fetchTMDB(`/tv/${show.id}/season/${i}`);
        const seasonDiv = document.createElement("div");
        seasonDiv.innerHTML = `<h3>Season ${i}</h3>`;
        const episodeGrid = document.createElement("div");
        episodeGrid.className = "tv-season-episode-grid";
        season.episodes.forEach((episode) => {
          const episodeCard = document.createElement("div");
          episodeCard.className = "episode-card";
          episodeCard.innerHTML = `
            <img src="${baseImageUrl}${episode.still_path || show.poster_path}" alt="Episode ${episode.episode_number}">
            <div>Episode ${episode.episode_number}</div>
          `;
          episodeCard.onclick = () => loadTvEpisode(show.id, i, episode.episode_number);
          episodeGrid.appendChild(episodeCard);
        });
        seasonDiv.appendChild(episodeGrid);
        seasonsList.appendChild(seasonDiv);
      }
      const favoriteBtn = document.getElementById("tv-favorite-btn");
      favoriteBtn.className = `favorite-btn ${isFavorite(show.id, "tv") ? "favorited" : ""}`;
      favoriteBtn.onclick = () => toggleFavorite(show, "tv");
    }

    function closeModal() {
      document.getElementById("modal").style.display = "none";
      document.getElementById("modal-video").src = "";
      document.getElementById("tv-episode-player").src = "";
      document.getElementById("tv-episode-player").style.display = "none";
      document.getElementById("tv-episode-next-btn").style.display = "none";
      currentSeason = 1;
      currentEpisode = 1;
    }

    function changeServer() {
      if (!lastModalMovie) return;
      const serverSelect = document.getElementById("server");
      const iframe = document.getElementById("modal-video");
      const playOverlay = iframe.parentElement.querySelector(".iframe-play-overlay");
      const currentServer = serverSelect.value;
      const movieId = lastModalMovie.id;
      let embedURL = "";
      if (currentServer === "player.videasy.net") {
        embedURL = `https://player.videasy.net/movie/${movieId}`;
      } else if (currentServer === "vidsrc.cc") {
        embedURL = `https://vidsrc.cc/v2/embed/movie/${movieId}`;
      } else if (currentServer === "vidsrc.me") {
        embedURL = `https://vidsrc.net/embed/movie/?tmdb=${movieId}`;
      }
      iframe.src = "";
      iframe.src = embedURL;
      iframe.onload = () => {
        try {
          iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', "*");
        } catch (e) {
          showErrorMessage(iframe, "Failed to start playback. Try another server or check your connection.");
        }
        playOverlay.style.display = "none";
      };
      iframe.onerror = () => {
        showErrorMessage(iframe, "Failed to load video. Try another server or check your connection.");
        playOverlay.style.display = "block";
      };
    }

    async function loadTvEpisode(showId, season, episode) {
      currentSeason = season;
      currentEpisode = episode;
      const iframe = document.getElementById("tv-episode-player");
      const playOverlay = iframe.parentElement.querySelector(".iframe-play-overlay");
      const nextBtn = document.getElementById("tv-episode-next-btn");
      iframe.src = `https://vidsrc.cc/v2/embed/tv/${showId}/${season}/${episode}`;
      iframe.style.display = "block";
      iframe.onload = () => {
        try {
          iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', "*");
        } catch (e) {
          showErrorMessage(iframe, "Failed to start playback. Try another server or check your connection.");
        }
        playOverlay.style.display = "none";
      };
      iframe.onerror = () => {
        showErrorMessage(iframe, "Failed to load episode. Try another server or check your connection.");
        playOverlay.style.display = "block";
      };
      const seasonData = await fetchTMDB(`/tv/${showId}/season/${season}`);
      const episodeCount = seasonData.episodes.length;
      nextBtn.style.display = episode < episodeCount ? "block" : "none";
      nextBtn.onclick = () => loadTvEpisode(showId, season, episode + 1);
    }

    function showErrorMessage(iframe, message) {
      const errorDiv = document.createElement("div");
      errorDiv.className = "error-message";
      errorDiv.textContent = message;
      iframe.parentElement.appendChild(errorDiv);
      setTimeout(() => errorDiv.remove(), 5000);
    }

    function triggerIframePlay(iframeId) {
      const iframe = document.getElementById(iframeId);
      try {
        iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', "*");
      } catch (e) {
        showErrorMessage(iframe, "Failed to start playback. Try another server or check your connection.");
      }
      iframe.parentElement.querySelector(".iframe-play-overlay").style.display = "none";
    }

    function isFavorite(id, type) {
      const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      return favorites.some((item) => item.id === id && item.type === type);
    }

    function toggleFavorite(item, type) {
      const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      const index = favorites.findIndex((fav) => fav.id === item.id && fav.type === type);
      if (index === -1) {
        favorites.push({ ...item, type });
      } else {
        favorites.splice(index, 1);
      }
      localStorage.setItem("favorites", JSON.stringify(favorites));
      document.querySelectorAll(".favorite-btn").forEach((btn) => {
        if (btn.parentElement.querySelector("h2").textContent === (item.title || item.name)) {
          btn.className = `favorite-btn ${isFavorite(item.id, type) ? "favorited" : ""}`;
        }
      });
      if (currentSection === "favorites") loadFavorites();
    }

    function shareMovie() {
      const movie = lastModalMovie;
      const text = `Check out ${movie.title} on MovieDck!`;
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({ title: movie.title, text, url });
      } else {
        navigator.clipboard.writeText(`${text} ${url}`);
        alert("Link copied to clipboard!");
      }
    }

    function shareTvShow() {
      const show = lastModalTvShow;
      const text = `Check out ${show.name} on MovieDck!`;
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({ title: show.name, text, url });
      } else {
        navigator.clipboard.writeText(`${text} ${url}`);
        alert("Link copied to clipboard!");
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadHomeContent();
      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          document.querySelectorAll(".tm-section").forEach((section) => (section.style.display = "none"));
          const section = link.dataset.section;
          document.getElementById(section).style.display = "block";
          currentSection = section;
          if (section === "movies") loadMovies();
          else if (section === "tv") loadTVShows();
          else if (section === "anime") loadAnime();
          else if (section === "favorites") loadFavorites();
        });
      });
      document.getElementById("movie-search-form").addEventListener("submit", (e) => {
        e.preventDefault();
        const query = document.getElementById("movie-search").value.trim();
        if (query) searchContent(query);
      });
      window.addEventListener("scroll", setNavbarScrolled);
    });

    function addDismissibleBanner() {
      if (sessionStorage.getItem('bannerDismissed')) {
        document.querySelectorAll('.donation-banner').forEach(banner => banner.style.display = 'none');
      }
      document.querySelectorAll('.donation-banner').forEach(banner => {
        const dismissBtn = document.createElement('button');
        dismissBtn.innerHTML = '&times;';
        dismissBtn.style.cssText = 'position: absolute; top: 5px; right: 5px; background: none; border: none; color: #eee; font-size: 1.2em; cursor: pointer;';
        dismissBtn.onclick = () => {
          banner.style.display = 'none';
          sessionStorage.setItem('bannerDismissed', 'true');
        };
        banner.style.position = 'relative';
        banner.appendChild(dismissBtn);
      });
    }
    document.addEventListener('DOMContentLoaded', addDismissibleBanner);
  </script>
</body>
</html>